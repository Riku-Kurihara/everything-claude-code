# コーディングスタイル

## イミュータビリティ (重要)

常に新しいオブジェクトを作成し、既存のオブジェクトは決して変更してはいけません：

```
// 疑似コード
間違い:  modify(original, field, value) → originalをインプレースで変更
正しい: update(original, field, value) → 変更を加えた新しいコピーを返す
```

根拠：イミュータブルなデータは隠れた副作用を防ぎ、デバッグを簡単にし、安全な並行処理を実現します。

## ファイル構成

小さなファイルが多い方が良い > 大きなファイルが少ない：
- 高凝集度、低結合度
- 通常 200-400 行、最大 800 行
- 大きなモジュールからユーティリティを抽出
- 型別ではなく機能別/ドメイン別に整理

## エラーハンドリング

すべてのレベルで包括的にエラーを処理してください：
- すべてのレベルで明示的にエラーを処理
- UI向けコードではユーザーフレンドリーなエラーメッセージを提供
- サーバー側では詳細なエラーコンテキストをログに記録
- エラーを黙って飲み込まない

## 入力検証

常にシステム境界で検証してください：
- 処理前にすべてのユーザー入力を検証
- 利用可能な場合はスキーマベースの検証を使用
- 明確なエラーメッセージで失敗
- 外部データを信頼しない（API レスポンス、ユーザー入力、ファイルコンテンツ）

## コード品質チェックリスト

作業を完了としてマークする前に：
- [ ] コードは読みやすく、適切に命名されている
- [ ] 関数は小さい（<50 行）
- [ ] ファイルは焦点が絞られている（<800 行）
- [ ] ネストが深くない（>4 レベル）
- [ ] 適切なエラーハンドリング
- [ ] ハードコードされた値がない（定数または設定を使用）
- [ ] ミューテーション（変更）がない（イミュータブルパターンを使用）
