# パフォーマンス最適化

## モデル選択戦略

**Haiku 4.5** （Sonnet 能力の 90%、コスト削減 3 倍）：
- 頻繁に呼び出す軽量エージェント
- ペアプログラミングとコード生成
- マルチエージェントシステム内のワーカーエージェント

**Sonnet 4.5** （最高のコーディングモデル）：
- メイン開発作業
- マルチエージェントワークフローの調整
- 複雑なコーディングタスク

**Opus 4.5** （最も深い推論）：
- 複雑なアーキテクチャ上の決定
- 最大推論が必要
- 研究と分析タスク

## コンテキストウィンドウ管理

以下の場合はコンテキストウィンドウの最後の 20% を避けてください：
- 大規模なリファクタリング
- 複数ファイルにまたがる機能実装
- 複雑な相互作用のデバッグ

低コンテキスト感度タスク：
- 単一ファイル編集
- 独立したユーティリティ作成
- ドキュメント更新
- 単純なバグ修正

## 拡張思考とプランモード

拡張思考はデフォルトで有効で、内部推論に最大 31,999 トークンを予約しています。

拡張思考の制御：
- **トグル**：Option+T (macOS) / Alt+T (Windows/Linux)
- **設定**：`~/.claude/settings.json` で `alwaysThinkingEnabled` を設定
- **予算上限**：`export MAX_THINKING_TOKENS=10000`
- **詳細モード**：Ctrl+O で思考出力を表示

深い推論が必要な複雑なタスクの場合：
1. 拡張思考が有効か確認（デフォルトでオン）
2. **プランモード** を有効化して構造化アプローチ
3. 徹底的な分析のため複数の批評ラウンドを使用
4. 多様な視点のため分割ロール・サブエージェントを使用

## ビルドトラブルシューティング

ビルドが失敗した場合：
1. **build-error-resolver** エージェントを使用
2. エラーメッセージを分析
3. 段階的に修正
4. 修正後に確認
