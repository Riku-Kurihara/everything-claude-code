---
description: 慣用的なパターン、並行処理の安全性、エラーハンドリング、セキュリティのための包括的なGo コードレビュー。go-reviewer エージェントを呼び出します。
---

# Go コードレビュー

このコマンドは **go-reviewer** エージェントを呼び出して、Go固有の包括的なコードレビューを実行します。

## このコマンドが行うこと

1. **Go 変更を特定**: `git diff` で変更された `.go` ファイルを検索
2. **静的分析を実行**: `go vet`, `staticcheck`, `golangci-lint` を実行
3. **セキュリティスキャン**: SQLインジェクション、コマンドインジェクション、競合状態をチェック
4. **並行処理レビュー**: ゴルーチン安全性、チャネル使用法、ミューテックスパターンを分析
5. **慣用的Go チェック**: コードが Go の規約とベストプラクティスに従っていることを確認
6. **レポート生成**: 重要度別に問題を分類

## いつ使用するか

以下の場合に `/go-review` を使用してください:
- Go コードを書いたり変更した後
- Go 変更をコミットする前
- Go コードを含むプルリクエストをレビューするとき
- 新しい Go コードベースへのオンボーディング時
- 慣用的な Go パターンを学ぶときw

## レビューカテゴリー

### 重大 (修正する必要がある)
- SQLインジェクション/コマンドインジェクション脆弱性
- 同期なしの競合状態
- ゴルーチンリーク
- ハードコードされたクレデンシャル
- 安全でないポインター使用法
- 重要なパスでのエラー無視

### 高い (修正すべき)
- コンテキストがないエラーラッピング
- エラーリターンの代わりにパニック
- コンテキストが伝播されない
- デッドロックの原因となるバッファなしチャネル
- インターフェース満たされないエラー
- ミューテックス保護の欠落

### 中程度 (検討)
- 非慣用的なコードパターン
- エクスポート上のgodocコメントの欠落
- 非効率な文字列連結
- スライスが事前割り当てされていない
- テーブル駆動テストが使用されていない

## 実行される自動チェック

```bash
# 静的分析
go vet ./...

# 高度なチェック (インストール済みの場合)
staticcheck ./...
golangci-lint run

# 競合状態検出
go build -race ./...

# セキュリティ脆弱性
govulncheck ./...
```

## 使用例

```text
ユーザー: /go-review

エージェント:
# Go コードレビューレポート

## レビュー済みファイル
- internal/handler/user.go (変更)
- internal/service/auth.go (変更)

## 静的分析結果
✓ go vet: 問題なし
✓ staticcheck: 問題なし

## 見つかった問題

[重大] 競合状態
ファイル: internal/service/auth.go:45
問題: 共有マップが同期なしでアクセスされています
```go
var cache = map[string]*Session{}  // 並行アクセス!

func GetSession(id string) *Session {
    return cache[id]  // 競合状態
}
```
修正: sync.RWMutex または sync.Map を使用
```go
var (
    cache   = map[string]*Session{}
    cacheMu sync.RWMutex
)

func GetSession(id string) *Session {
    cacheMu.RLock()
    defer cacheMu.RUnlock()
    return cache[id]
}
```

[高い] エラーコンテキストの欠落
ファイル: internal/handler/user.go:28
問題: コンテキストなしでエラーが返されています
```go
return err  // コンテキストなし
```
修正: コンテキストでラップ
```go
return fmt.Errorf("ユーザー %s を取得: %w", userID, err)
```

## サマリー
- 重大: 1
- 高い: 1
- 中程度: 0

推奨: ❌ 重大な問題が修正されるまでマージをブロック
```

## 承認基準

| ステータス | 条件 |
|--------|-----------|
| ✅ 承認 | 重大または高い問題なし |
| ⚠️ 警告 | 中程度の問題のみ (注意してマージ) |
| ❌ ブロック | 重大または高い問題が見つかった |

## 他のコマンドとの統合

- テストが成功することを確認するために `/go-test` を最初に実行
- ビルドエラーが発生した場合は `/go-build` を使用
- コミット前に `/go-review` を実行
- Go 固有以外の懸念については `/code-review` を使用

## 関連

- エージェント: `agents/go-reviewer.md`
- スキル: `skills/golang-patterns/`, `skills/golang-testing/`
