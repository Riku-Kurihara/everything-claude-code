---
name: strategic-compact
description: タスクフェーズ全体を通してコンテキストを保持するために、任意の自動圧縮ではなく、論理的な間隔で手動コンテキスト圧縮を提案します。
---

# 戦略的コンパクトスキル

任意の自動圧縮に頼るのではなく、ワークフロー内の戦略的なポイントで手動 `/compact` を使用することを提案します。

## 戦略的圧縮が必要な理由

自動圧縮は任意のポイントでトリガーされます：
- 多くの場合、タスク中盤に発動して重要なコンテキストを失う
- 論理的なタスク境界を認識しない
- 複雑なマルチステップ操作を中断する可能性があります

論理的な境界での戦略的圧縮：
- **探索後、実行前** - 研究コンテキストを圧縮し、実装計画を保持
- **マイルストーン完了後** - 次のフェーズの新しいスタート
- **大きなコンテキストシフト前** - 異なるタスク前に探索コンテキストをクリア

## 仕組み

`suggest-compact.sh` スクリプトは PreToolUse（Edit/Write）で実行され：

1. **ツール呼び出しを追跡** - セッションでのツール呼び出しを計数
2. **閾値検出** - 設定可能な閾値（デフォルト：50 呼び出し）で提案
3. **定期的なリマインダー** - 閾値後、25 呼び出しごとにリマインダー

## フック設定

`~/.claude/settings.json` に追加：

```json
{
  "hooks": {
    "PreToolUse": [{
      "matcher": "tool == \"Edit\" || tool == \"Write\"",
      "hooks": [{
        "type": "command",
        "command": "~/.claude/skills/strategic-compact/suggest-compact.sh"
      }]
    }]
  }
}
```

## 設定

環境変数：
- `COMPACT_THRESHOLD` - 最初の提案前のツール呼び出し（デフォルト：50）

## ベストプラクティス

1. **計画後に圧縮** - 計画が完成したら、新しく開始するために圧縮
2. **デバッグ後に圧縮** - エラー解決のコンテキストをクリアしてから継続
3. **実装中に圧縮しない** - 関連する変更のコンテキストを保持
4. **提案を読む** - フックは *いつ* を指示し、*するかどうか* はあなたが判断

## 関連

- [Longform ガイド](https://x.com/affaanmustafa/status/2014040193557471352) - トークン最適化セクション
- メモリ永続フック - 圧縮を超えて保持される状態用
